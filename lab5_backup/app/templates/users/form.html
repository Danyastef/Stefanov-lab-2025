{% macro user_form(roles, action, user_data={}, errors={}, readonly_role=False) %}
<form method="post">
    {% if action == 'new' %}
    <div class="mb-3">
        <label for="exampleInputLogin1">Логин</label>
        <input class="form-control {{ 'is-invalid' if errors.get('username') }}" id="exampleInputLogin1" placeholder="Логин" name="username" value="{{ user_data.username or '' }}">
        {% if errors.get('username') %}
            <div class="invalid-feedback">{{ errors.get('username') }}</div>
        {% endif %}
    </div>
    <div class="mb-3">
        <label for="exampleInputPassword1">Пароль</label>
        <input type="password" class="form-control {{ 'is-invalid' if errors.get('password') }}" id="exampleInputPassword1" placeholder="Пароль" name="password" value="{{ user_data.password or '' }}">
        {% if errors.get('password') %}
            <div class="invalid-feedback">{{ errors.get('password') }}</div>
        {% endif %}
    </div>
    {% endif %}
    <div class="mb-3">
        <label for="exampleInputLastName1">Фамилия</label>
        <input class="form-control {{ 'is-invalid' if errors.get('last_name') }}" id="exampleInputLastName1" placeholder="Фамилия" name="last_name" value="{{ user_data.last_name or '' }}">
        {% if errors.get('last_name') %}
            <div class="invalid-feedback">{{ errors.get('last_name') }}</div>
        {% endif %}
    </div>
    <div class="mb-3">
        <label for="exampleInputFirstName1">Имя</label>
        <input class="form-control {{ 'is-invalid' if errors.get('first_name') }}" id="exampleInputFirstName1" placeholder="Имя" name="first_name" value="{{ user_data.first_name or '' }}">
        {% if errors.get('first_name') %}
            <div class="invalid-feedback">{{ errors.get('first_name') }}</div>
        {% endif %}
    </div>
    <div class="mb-3">
        <label for="exampleInputMiddleName1">Отчество (опционально)</label>
        <input class="form-control" id="exampleInputMiddleName1" placeholder="Отчество" name="middle_name" value="{{ user_data.middle_name or '' }}">
    </div>
    <div class="mb-3">
        <label for="exampleFormControlRole1">Роль</label>
        {% if readonly_role %}
            <input type="hidden" name="role_id" value="{{ user_data.role_id }}">
        {% endif %}
        <select class="form-control" name="role_id" id="exampleFormControlRole1" {% if readonly_role %}disabled{% endif %}>
            {% for role in roles %}
                <option value="{{ role.id }}" {% if role.id | string == user_data.role_id | string %}selected{% endif %}>{{ role.name }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Сохранить</button>
</form>
{% endmacro %}